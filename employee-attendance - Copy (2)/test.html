<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Employee Attendance System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>Employee Attendance System - Test Page</h1>
    
    <div class="test-section">
        <h2>Database Test</h2>
        <button class="test-button" onclick="testDatabase()">Test Database</button>
        <div id="db-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Authentication Test</h2>
        <button class="test-button" onclick="testAuth()">Test Authentication</button>
        <div id="auth-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Employee Management Test</h2>
        <button class="test-button" onclick="testEmployees()">Test Employee CRUD</button>
        <div id="emp-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Attendance Test</h2>
        <button class="test-button" onclick="testAttendance()">Test Clock In/Out</button>
        <div id="att-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Leave Management Test</h2>
        <button class="test-button" onclick="testLeaves()">Test Leave Requests</button>
        <div id="leave-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Payroll Test</h2>
        <button class="test-button" onclick="testPayroll()">Test Payroll Calculation</button>
        <div id="payroll-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Navigation Test</h2>
        <button class="test-button" onclick="window.open('index.html', '_blank')">Open Login Page</button>
        <button class="test-button" onclick="window.open('admin.html', '_blank')">Open Admin Panel</button>
        <button class="test-button" onclick="window.open('dashboard.html', '_blank')">Open Employee Dashboard</button>
    </div>

    <script src="js/database.js"></script>
    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        function testDatabase() {
            try {
                const stats = db.getStatistics();
                const employees = db.getEmployees();
                const schedules = db.getSchedules();
                
                let message = `
                    <strong>Database Test Results:</strong><br>
                    • Total Employees: ${stats.totalEmployees}<br>
                    • Present Today: ${stats.presentToday}<br>
                    • Absent Today: ${stats.absentToday}<br>
                    • Pending Leaves: ${stats.pendingLeaves}<br>
                    • Sample Employee: ${employees[0] ? employees[0].firstName + ' ' + employees[0].lastName : 'None'}<br>
                    • Schedule Types: ${Object.keys(schedules).length}
                `;
                
                showResult('db-result', message, 'success');
            } catch (error) {
                showResult('db-result', `Database Error: ${error.message}`, 'error');
            }
        }

        function testAuth() {
            try {
                // Test authentication without face data
                const user = db.authenticateEmployee('ADMIN001');
                
                if (user) {
                    let message = `
                        <strong>Authentication Test Results:</strong><br>
                        • User: ${user.firstName} ${user.lastName}<br>
                        • ID: ${user.id}<br>
                        • Authority: ${user.authority}<br>
                        • Status: ${user.status}<br>
                        • Department: ${user.department}
                    `;
                    showResult('auth-result', message, 'success');
                } else {
                    showResult('auth-result', 'Authentication failed for ADMIN001', 'error');
                }
            } catch (error) {
                showResult('auth-result', `Authentication Error: ${error.message}`, 'error');
            }
        }

        function testEmployees() {
            try {
                const employees = db.getEmployees();
                const initialCount = employees.length;
                
                // Test adding employee
                const newEmployee = {
                    id: 'TEST001',
                    firstName: 'Test',
                    middleName: '',
                    lastName: 'Employee',
                    email: 'test@company.com',
                    phone: '+1234567890',
                    address: 'Test Address',
                    birthday: '1990-01-01',
                    civilStatus: 'single',
                    hireDate: '2024-01-01',
                    position: 'Test Position',
                    department: 'store',
                    scheduleGroup: 'store-based',
                    dailyRate: 500,
                    hourlyRate: 62.5,
                    authority: 'basic',
                    status: 'active',
                    faceData: null,
                    leaveCredits: { annual: 15, sick: 10, emergency: 5 }
                };
                
                db.addEmployee(newEmployee);
                const afterAdd = db.getEmployees().length;
                
                // Test updating employee
                db.updateEmployee('TEST001', { position: 'Updated Position' });
                const updated = db.getEmployee('TEST001');
                
                // Test deleting employee
                db.deleteEmployee('TEST001');
                const afterDelete = db.getEmployees().length;
                
                let message = `
                    <strong>Employee Management Test Results:</strong><br>
                    • Initial Count: ${initialCount}<br>
                    • After Add: ${afterAdd}<br>
                    • Update Success: ${updated.position === 'Updated Position' ? 'Yes' : 'No'}<br>
                    • After Delete: ${afterDelete}<br>
                    • CRUD Operations: ${afterDelete === initialCount ? 'Success' : 'Failed'}
                `;
                
                showResult('emp-result', message, 'success');
            } catch (error) {
                showResult('emp-result', `Employee Management Error: ${error.message}`, 'error');
            }
        }

        function testAttendance() {
            try {
                const employeeId = 'EMP001';
                const today = new Date().toISOString().split('T')[0];
                
                // Test clock in
                const clockInResult = db.clockIn(employeeId);
                
                // Wait a moment and test clock out
                setTimeout(() => {
                    const clockOutResult = db.clockOut(employeeId);
                    
                    const attendance = db.getAttendance(today, employeeId);
                    
                    let message = `
                        <strong>Attendance Test Results:</strong><br>
                        • Clock In: ${clockInResult.success ? 'Success' : 'Failed'}<br>
                        • Clock Out: ${clockOutResult.success ? 'Success' : 'Failed'}<br>
                        • Hours Worked: ${clockOutResult.success ? clockOutResult.record.hoursWorked + 'h' : 'N/A'}<br>
                        • Overtime: ${clockOutResult.success ? clockOutResult.record.overtimeHours + 'h' : 'N/A'}<br>
                        • Records Today: ${attendance.length}
                    `;
                    
                    showResult('att-result', message, clockInResult.success && clockOutResult.success ? 'success' : 'error');
                }, 1000);
                
                showResult('att-result', 'Testing attendance... Please wait...', 'info');
            } catch (error) {
                showResult('att-result', `Attendance Error: ${error.message}`, 'error');
            }
        }

        function testLeaves() {
            try {
                const leaveRequest = {
                    employeeId: 'EMP001',
                    employeeName: 'John Doe',
                    leaveType: 'annual',
                    startDate: '2024-12-25',
                    endDate: '2024-12-27',
                    reason: 'Christmas vacation'
                };
                
                const result = db.submitLeaveRequest(leaveRequest);
                const requests = db.getLeaveRequests('EMP001');
                
                // Test approval
                db.updateLeaveRequest(result.id, { 
                    status: 'approved',
                    approvedBy: 'ADMIN001',
                    approvedDate: new Date().toISOString()
                });
                
                const approvedRequests = db.getLeaveRequests('EMP001', 'approved');
                
                let message = `
                    <strong>Leave Management Test Results:</strong><br>
                    • Request Submitted: ${result ? 'Success' : 'Failed'}<br>
                    • Request ID: ${result.id}<br>
                    • Total Requests: ${requests.length}<br>
                    • Approved Requests: ${approvedRequests.length}<br>
                    • Status Update: ${approvedRequests.length > 0 ? 'Success' : 'Failed'}
                `;
                
                showResult('leave-result', message, 'success');
            } catch (error) {
                showResult('leave-result', `Leave Management Error: ${error.message}`, 'error');
            }
        }

        function testPayroll() {
            try {
                const employeeId = 'EMP001';
                const startDate = '2024-08-01';
                const endDate = '2024-08-31';
                
                const payroll = db.calculatePayroll(employeeId, startDate, endDate);
                
                let message = `
                    <strong>Payroll Test Results:</strong><br>
                    • Employee: ${payroll.employeeName}<br>
                    • Days Worked: ${payroll.daysWorked}<br>
                    • Total Hours: ${payroll.totalHours}h<br>
                    • Overtime Hours: ${payroll.totalOvertimeHours}h<br>
                    • Basic Pay: $${payroll.basicPay}<br>
                    • Overtime Pay: $${payroll.overtimePay}<br>
                    • Gross Pay: $${payroll.grossPay}<br>
                    • Net Pay: $${payroll.netPay}
                `;
                
                showResult('payroll-result', message, 'success');
            } catch (error) {
                showResult('payroll-result', `Payroll Error: ${error.message}`, 'error');
            }
        }

        // Auto-run database test on page load
        window.addEventListener('load', () => {
            testDatabase();
        });
    </script>
</body>
</html>